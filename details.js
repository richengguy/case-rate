(()=>{"use strict";const e=Chart;class t{constructor(e){this._values=e}get upperInterval(){return this._values[0]}get lowerInterval(){return this._values[1]}}class n{constructor(e){var n;this._interpolated=e.interpolated,this._raw=null!==(n=e.raw)&&void 0!==n?n:[],this._confidence=[],null!=e.confidenceInterval&&(this._confidence=e.confidenceInterval.map((e=>new t(e))))}get interpolated(){return this._interpolated}get raw(){return this._raw}get confidenceIntervals(){return this._confidence}get hasRaw(){return 0!=this._raw.length}get hasConfidenceIntervals(){return 0!=this._confidence.length}}class r{constructor(e){this._dates=e.date,this._length=e.date.length,this._samples={};for(const t of e.timeseries)this._samples[t.name]=new n(t)}get length(){return this._length}get dates(){return this._dates}get series(){return this._samples}static FetchUrlAsync(e){return t=this,n=void 0,o=function*(){var t=yield fetch(e),n=yield t.json();return new r(n)},new((i=void 0)||(i=Promise))((function(e,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o}}var i=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};class o{constructor(e,t){this._name=e,this._url=t}get name(){return this._name}get url(){return this._url}}class a{constructor(e,t,n){this._base=e,this._date=t,this._source=new o(n.description,n.url);var r=n.name,i=r.indexOf(":");i<0?(this._country=r,this._region=null):(this._country=r.substring(0,i),this._region=r.substring(i+1))}get country(){return this._country}get region(){return this._region}get source(){return this._source}FetchTimeSeriesAsync(){return i(this,void 0,void 0,(function*(){let e;e=null==this._region?`${this._country}.json`:`${this._country}_${this._region}.json`;let t=`${this._base}/${e}?t=${this._date.getTime()}`;return yield r.FetchUrlAsync(t)}))}}class s{constructor(e,t,n){this._config=n,this._generated=e,this._regions=t}entryDetails(e){return this._regions[e]}entryDetailsByName(e,t){for(const n of this._regions){let r=e===n.country,i=t===n.region;if(r&&i)return n}return null}listSubnationalRegions(e){let t=[];for(const n of this._regions)null!==n.region&&n.country===e&&t.push(n.region);return t}get configuration(){return this._config}get generatedOn(){return this._generated}get numberOfEntries(){return this._regions.length}static LoadAsync(e){return i(this,void 0,void 0,(function*(){const t=(new Date).getTime(),n=yield fetch(`${e}/analysis.json?t=${t}`),r=yield n.json(),i=new Date(r.generated);return new s(i,r.regions.map((t=>new a(e,i,t))),r.config)}))}}const l="#244A57",c="#458CA3";function u(e){return new URL(document.location.href).searchParams.get(e)}function d(e){let t=u(e);if(null==t)return null;let n=parseInt(t);return isNaN(n)?null:n}function h(e){let t=d("pastDays");return g(e.dates,t)}function g(e,t){return null==t?e:e.slice(-t)}function f(e,t){return{type:"bar",label:"Reported",data:g(e.raw,t),backgroundColor:"#C0D6DD",barPercentage:1,categoryPercentage:1}}function y(e,t){return{type:"line",label:"LOESS Filtered",data:g(e.interpolated,t),backgroundColor:l,borderColor:l,fill:!1,pointRadius:0,borderWidth:1.5,cubicInterpolationMode:void 0}}window.onload=()=>{let t=u("country"),n=u("region");if(null==t)throw new Error("No particular case report data was selected.");!function(){var e;const t=null!==(e=d("pastDays"))&&void 0!==e?e:"all";[60,90,180,"all"].map((e=>{let n=document.getElementById(`days-${e}`);return n.onclick=()=>{let t=new URL(document.location.href);t.searchParams.set("pastDays",e.toString()),document.location.href=t.toString()},e===t&&n.classList.add("font-bold"),n}))}(),e.defaults.global.legend.onClick=()=>{},s.LoadAsync("_analysis").then((e=>{let r=document.getElementById("info-date-generated"),i=document.getElementById("info-region"),o=document.getElementById("info-source"),a=e.entryDetailsByName(t,n);return r.innerText=e.generatedOn.toDateString(),function(e,t,n){if(0===n.length)return void(e.innerText=t.country);e.innerText=`${t.country} - `;let r=document.createElement("select"),i=document.createElement("option");i.innerText="National",i.onclick=()=>{let e=new URL(document.location.href);e.searchParams.delete("region"),document.location.href=e.toString()},r.appendChild(i);let o=u("region");for(const e of n){let t=document.createElement("option");t.innerText=e,t.onclick=()=>{let t=new URL(document.location.href);t.searchParams.set("region",e),document.location.href=t.toString()},e===o&&(t.selected=!0),r.appendChild(t)}e.appendChild(r)}(i,a,e.listSubnationalRegions(a.country)),o.href=a.source.url,o.innerText=a.source.name,a.FetchTimeSeriesAsync()})).then((t=>{let n=document.getElementById("daily-change"),r=document.getElementById("growth-factor"),i=document.getElementById("cumulative-cases");(function(t,n){let r=d("pastDays"),i=t.series.dailyChange,o=function(e,t){let n=g(e.confidenceIntervals,t),r=n.map((e=>e.upperInterval)),i=n.map((e=>e.lowerInterval));return[{type:"line",label:"LOESS Confidence",data:r,fill:!1,pointRadius:0,borderWidth:1,borderDash:[5,5],borderColor:c},{type:"line",label:"LOESS Confidence - Lower",data:i,fill:!1,pointRadius:0,borderWidth:1,borderDash:[5,5],borderColor:c}]}(i,r),a=[y(i,r),o[0],o[1],f(i,r)];new e(n,{type:"line",data:{labels:h(t),datasets:a},options:{maintainAspectRatio:!1,legend:{labels:{filter:(e,t)=>"LOESS Confidence - Lower"!==e.text}},scales:{yAxes:[{ticks:{min:0},scaleLabel:{display:!0,labelString:"Cases"}}]}}})})(t,n),function(t,n){let r=d("pastDays"),i=y(t.series.growthFactor,r);for(let e=0;e<i.data.length;e++){let t=i.data[e];i.data[e]=100*(t-1)}new e(n,{type:"line",data:{labels:h(t),datasets:[i]},options:{maintainAspectRatio:!1,legend:{display:!1},scales:{yAxes:[{ticks:{suggestedMin:-25,suggestedMax:25,callback:e=>e+"%"},scaleLabel:{display:!0,labelString:"Relative Growth"}}]}}})}(t,r),function(t,n){let r=d("pastDays"),i=t.series.cases,o=f(i,r),a=y(i,r);new e(n,{type:"line",data:{labels:h(t),datasets:[a,o]},options:{maintainAspectRatio:!1,scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Cumulative Cases"}}]}}})}(t,i)}))}})();